## Context

3~7세 유아/어린이 대상 그림그리기 앱을 Flutter로 신규 개발한다. iOS/Android 동시 지원이 필요하며, 오프라인 환경에서 완전히 동작해야 한다. 가이드 이미지(선 따라 그리기, 색칠 도안)는 앱에 내장하여 제공한다. 4가지 그리기 모드(선 따라 그리기, 숫자/ABC 색칠, 대칭 그리기, 자유 그리기)를 지원하며, 그린 그림의 저장/내보내기가 가능해야 한다.

## Goals / Non-Goals

**Goals:**
- Flutter 단일 코드베이스로 iOS/Android 앱 동시 빌드
- 4가지 그리기 모드를 독립적으로 동작하는 모듈로 구현 (추후 다른 모드 고려)
- 3~7세 대상 UX: 큰 터치 영역, 단순한 UI, 밝은 색상, 아이콘 중심 (텍스트 최소화)
- 오프라인 완전 동작 (네트워크 의존 없음)
- 그린 그림을 로컬 저장 및 이미지 파일로 내보내기/공유

**Non-Goals:**
- 서버/클라우드 동기화 (향후 고려)
- 사용자 계정/로그인 시스템
- 앱 내 결제 또는 광고
- 태블릿 전용 UI 최적화 (MVP에서는 폰/태블릿 공통 반응형)
- 실시간 협업 드로잉

## Decisions

### 1. 프로젝트 구조: Feature-first 구조

```
lib/
├── main.dart
├── app.dart
├── core/                    # 공통 유틸, 테마, 상수
│   ├── theme/
│   ├── constants/
│   └── utils/
├── features/
│   ├── mode_selection/      # 모드 선택 화면
│   ├── trace_drawing/       # A. 선 따라 그리기
│   ├── color_by_symbol/     # B. 숫자/ABC 색칠
│   ├── symmetry_drawing/    # C. 대칭 그리기
│   ├── free_drawing/        # D. 자유 그리기
│   └── gallery/             # 저장된 그림 갤러리
├── shared/
│   ├── widgets/             # 공통 위젯 (색상 팔레트, 도구 바 등)
│   ├── models/              # 공통 모델 (Stroke, DrawingData 등)
│   └── services/            # 저장, 내보내기 서비스
assets/
├── templates/
│   ├── trace/               # 선 따라 그리기용 가이드 이미지
│   └── coloring/            # 색칠 도안 (SVG)
├── brushes/                 # 브러시/패턴 텍스처
└── sounds/                  # 효과음 (선택)
```

**이유**: 각 모드가 독립적인 feature이므로 feature-first 구조가 모드별 독립 개발/확장에 적합하다.

### 2. 드로잉 엔진: Flutter CustomPainter + Canvas API

Flutter 내장 `CustomPainter`와 `Canvas` API를 직접 사용한다. 외부 드로잉 엔진 라이브러리 대신 직접 구현하는 이유:
- 4가지 모드 각각 다른 드로잉 동작이 필요 (대칭 미러링, 영역 채우기 등)
- `perfect_freehand` 패키지를 활용하여 자연스러운 필압 효과 적용
- 커스텀 렌더링 파이프라인으로 모드별 특수 동작 제어 가능

**대안 검토**: `flutter_drawing_board` 등 기존 드로잉 라이브러리 → 모드별 특수 동작 구현에 제약이 커서 제외

### 3. 상태 관리: Riverpod

- 각 모드의 드로잉 상태(스트로크, 선택 도구, 색상 등)를 Provider로 관리
- 모드 간 공유 상태(선택된 색상, 브러시 크기)와 모드별 고유 상태 분리
- **대안 검토**: BLoC → 유아 앱 특성상 복잡한 이벤트 스트림이 불필요, Riverpod이 더 간결

### 4. 색칠 도안 포맷: SVG

B모드(숫자/ABC 색칠)의 도안을 SVG로 관리한다.
- SVG path 단위로 영역을 구분하여 탭 시 해당 영역만 색상 채우기 가능
- `flutter_svg` 패키지로 렌더링, 각 path에 메타데이터(숫자/알파벳 매핑) 부여
- **대안 검토**: 래스터 이미지 + flood fill → 영역 경계 정확도가 떨어지고 성능 이슈

### 5. 로컬 저장: SQLite + 파일 시스템

- 그림 메타데이터(제목, 모드, 생성일 등)는 SQLite(`sqflite`)에 저장
- 실제 드로잉 데이터는 JSON 직렬화하여 파일로 저장
- 내보내기 시 Canvas를 PNG로 렌더링하여 갤러리에 저장 (`image_gallery_saver`)
- **대안 검토**: Hive → SQLite가 쿼리/정렬에 더 유연

### 6. 대칭 그리기 구현: 실시간 Canvas 미러링

C모드에서 사용자의 터치 입력을 실시간으로 대칭축(세로축) 기준으로 미러링하여 동시 렌더링한다.
- 터치 포인트 `(x, y)` → 미러 포인트 `(canvasWidth - x, y)` 변환
- 두 스트로크를 동시에 Canvas에 그려 시각적 즉각 피드백 제공

## Risks / Trade-offs

- **앱 번들 크기 증가** → 내장 에셋(가이드 이미지, 도안)이 많아지면 앱 크기가 커짐. 초기에는 카테고리별 5~10개로 제한하고, 향후 다운로드 방식 검토
- **SVG 파싱 성능** → 복잡한 도안의 경우 SVG 파싱이 느릴 수 있음. 도안 복잡도를 유아 수준에 맞게 단순하게 유지
- **CustomPainter 복잡도** → 4가지 모드 각각 커스텀 페인터 구현 필요. 공통 베이스 클래스로 중복 최소화
- **디바이스 다양성** → 다양한 화면 크기에서 드로잉 경험 일관성 유지 필요. 캔버스 비율 고정 + 여백 처리로 대응
